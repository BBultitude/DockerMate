{% extends "base.html" %}

{% block title %}Containers - DockerMate{% endblock %}

{% block content %}
<div class="min-h-screen bg-slate-900" x-data="containersPage()" x-init="init()">
    <!-- Shared Navigation Bar -->
    {% include 'components/navbar.html' %}
    
    <!-- Toast Notification System -->
    <div x-show="toast.show" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform translate-y-2"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 transform translate-y-0"
         x-transition:leave-end="opacity-0 transform translate-y-2"
         class="fixed top-4 right-4 z-50 max-w-md">
        <div :class="{
            'bg-green-600': toast.type === 'success',
            'bg-red-600': toast.type === 'error',
            'bg-blue-600': toast.type === 'info',
            'bg-yellow-600': toast.type === 'warning'
        }" class="rounded-lg shadow-lg p-4 text-white">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <span x-show="toast.type === 'success'" class="text-2xl">‚úì</span>
                    <span x-show="toast.type === 'error'" class="text-2xl">‚úó</span>
                    <span x-show="toast.type === 'info'" class="text-2xl">‚Ñπ</span>
                    <span x-show="toast.type === 'warning'" class="text-2xl">‚ö†</span>
                </div>
                <div class="ml-3 flex-1">
                    <p class="font-medium" x-text="toast.message"></p>
                </div>
                <button @click="toast.show = false" class="ml-4 flex-shrink-0 hover:text-gray-200">
                    <span class="text-xl">&times;</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div x-show="deleteModal.show" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto"
         @click.self="deleteModal.show = false">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-75"></div>
            <div class="relative bg-slate-800 rounded-lg max-w-md w-full p-6 shadow-xl border border-slate-700"
                 @click.stop>
                <div class="text-center">
                    <div class="text-red-500 text-5xl mb-4">‚ö†</div>
                    <h3 class="text-xl font-bold text-white mb-2">Delete Container</h3>
                    <p class="text-slate-300 mb-4">
                        Are you sure you want to delete 
                        <span class="font-mono text-blue-400" x-text="deleteModal.containerName"></span>?
                    </p>
                    <p class="text-slate-400 text-sm mb-6">
                        This action cannot be undone. The container will be stopped and removed.
                    </p>
                    <div class="flex justify-center space-x-4">
                        <button @click="deleteModal.show = false"
                                class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-md transition">
                            Cancel
                        </button>
                        <button @click="confirmDelete()"
                                :disabled="deleteModal.loading"
                                class="px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-red-400 disabled:cursor-not-allowed text-white rounded-md transition font-medium">
                            <span x-show="!deleteModal.loading">Delete Container</span>
                            <span x-show="deleteModal.loading">Deleting...</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Container Details Modal -->
    <div x-show="detailsModal.show" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto"
         @click.self="detailsModal.show = false">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-75"></div>
            <div class="relative bg-slate-800 rounded-lg max-w-3xl w-full p-6 shadow-xl border border-slate-700 max-h-[90vh] overflow-y-auto"
                 @click.stop>
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-xl font-bold text-white" x-text="detailsModal.container?.name || 'Container Details'"></h3>
                    <button @click="detailsModal.show = false" class="text-slate-400 hover:text-white text-2xl">
                        &times;
                    </button>
                </div>
                
                <div x-show="detailsModal.container" class="space-y-4">
                    <!-- Status and Environment -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-slate-400 text-sm">Status</label>
                            <div class="mt-1">
                                <span :class="{
                                    'bg-green-600': detailsModal.container?.status === 'running',
                                    'bg-red-600': detailsModal.container?.status === 'stopped' || detailsModal.container?.status === 'exited',
                                    'bg-yellow-600': detailsModal.container?.status === 'paused',
                                    'bg-blue-600': detailsModal.container?.status === 'created'
                                }" class="px-3 py-1 rounded text-white text-sm font-medium" x-text="detailsModal.container?.status"></span>
                            </div>
                        </div>
                        <div>
                            <label class="text-slate-400 text-sm">Environment</label>
                            <div class="mt-1">
                                <span :class="{
                                    'bg-red-600': detailsModal.container?.environment === 'PRD',
                                    'bg-yellow-600': detailsModal.container?.environment === 'UAT',
                                    'bg-green-600': detailsModal.container?.environment === 'DEV',
                                    'bg-blue-600': detailsModal.container?.environment === 'SANDBOX'
                                }" class="px-3 py-1 rounded text-white text-sm font-medium" x-text="detailsModal.container?.environment || 'None'"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Basic Info -->
                    <div class="bg-slate-900 rounded p-4 space-y-2">
                        <div class="flex justify-between">
                            <span class="text-slate-400">Container ID:</span>
                            <span class="text-white font-mono text-sm" x-text="detailsModal.container?.container_id?.substring(0, 12)"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">Image:</span>
                            <span class="text-white font-mono text-sm" x-text="detailsModal.container?.image"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">Created:</span>
                            <span class="text-white text-sm" x-text="formatDate(detailsModal.container?.created_at)"></span>
                        </div>
                    </div>
                    
                    <!-- Ports -->
                    <div x-show="detailsModal.container?.ports && detailsModal.container.ports.length > 0">
                        <label class="text-slate-400 text-sm">Port Mappings</label>
                        <div class="mt-1 bg-slate-900 rounded p-3">
                            <template x-for="port in detailsModal.container?.ports" :key="port">
                                <div class="text-white font-mono text-sm" x-text="port"></div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Environment Variables -->
                    <div x-show="detailsModal.container?.env_vars && detailsModal.container.env_vars.length > 0">
                        <label class="text-slate-400 text-sm">Environment Variables</label>
                        <div class="mt-1 bg-slate-900 rounded p-3 max-h-40 overflow-y-auto">
                            <template x-for="env in detailsModal.container?.env_vars" :key="env">
                                <div class="text-white font-mono text-sm" x-text="env"></div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Volumes -->
                    <div x-show="detailsModal.container?.volumes && detailsModal.container.volumes.length > 0">
                        <label class="text-slate-400 text-sm">Volume Mounts</label>
                        <div class="mt-1 bg-slate-900 rounded p-3">
                            <template x-for="volume in detailsModal.container?.volumes" :key="volume">
                                <div class="text-white font-mono text-sm" x-text="volume"></div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- CLI Command Equivalent -->
                    <div>
                        <label class="text-slate-400 text-sm">Docker CLI Equivalent</label>
                        <div class="mt-1 bg-slate-900 rounded p-3 overflow-x-auto">
                            <pre class="text-green-400 font-mono text-xs whitespace-pre-wrap" x-text="generateDockerCommand(detailsModal.container)"></pre>
                        </div>
                        <p class="text-slate-500 text-xs mt-1">
                            üí° Educational: This is the equivalent CLI command to recreate this container
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header with Hardware Stats -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 space-y-4 md:space-y-0">
            <div>
                <h2 class="text-3xl font-bold text-white">Containers</h2>
                <p class="text-slate-400 mt-1">Manage your Docker containers</p>
            </div>
            <div class="flex items-center space-x-4">
                <!-- Hardware Limits Display -->
                <div class="bg-slate-800 px-4 py-2 rounded-lg border border-slate-700">
                    <div class="text-sm text-slate-400">Containers</div>
                    <div class="text-lg font-bold text-white">
                        <span x-text="runningCount"></span> / <span x-text="hardwareProfile.max_containers || '--'"></span>
                    </div>
                    <div class="text-xs text-slate-500" x-text="hardwareProfile.profile_name || 'Loading...'"></div>
                </div>
                
                <!-- Create Button (Disabled - Coming in Task 7) -->
                <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition opacity-50 cursor-not-allowed" 
                        disabled
                        title="Coming in Task 7: Container Create Form">
                    <span class="mr-2">+</span> Create Container
                </button>
            </div>
        </div>
        
        <!-- Filters -->
        <div class="bg-slate-800 rounded-lg border border-slate-700 p-4 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Search -->
                <div>
                    <label class="block text-sm text-slate-400 mb-1">Search</label>
                    <input type="text" 
                           x-model="filters.search"
                           @input="applyFilters()"
                           placeholder="Container name..."
                           class="w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-md text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <!-- Status Filter -->
                <div>
                    <label class="block text-sm text-slate-400 mb-1">Status</label>
                    <select x-model="filters.status" 
                            @change="applyFilters()"
                            class="w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="all">All Statuses</option>
                        <option value="running">Running</option>
                        <option value="stopped">Stopped</option>
                        <option value="exited">Exited</option>
                        <option value="paused">Paused</option>
                        <option value="created">Created</option>
                    </select>
                </div>
                
                <!-- Environment Filter -->
                <div>
                    <label class="block text-sm text-slate-400 mb-1">Environment</label>
                    <select x-model="filters.environment" 
                            @change="applyFilters()"
                            class="w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="all">All Environments</option>
                        <option value="PRD">Production</option>
                        <option value="UAT">UAT</option>
                        <option value="DEV">Development</option>
                        <option value="SANDBOX">Sandbox</option>
                        <option value="none">No Environment</option>
                    </select>
                </div>
                
                <!-- Refresh Button -->
                <div class="flex items-end">
                    <button @click="loadContainers()" 
                            :disabled="loading"
                            class="w-full px-4 py-2 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-700 disabled:cursor-not-allowed text-white rounded-md transition">
                        <span x-show="!loading">üîÑ Refresh</span>
                        <span x-show="loading">‚è≥ Loading...</span>
                    </button>
                </div>
            </div>
            
            <!-- Active Filters Display -->
            <div x-show="hasActiveFilters()" class="mt-3 pt-3 border-t border-slate-700">
                <div class="flex items-center space-x-2 text-sm">
                    <span class="text-slate-400">Active filters:</span>
                    <button @click="clearFilters()" class="text-blue-400 hover:text-blue-300">Clear all</button>
                </div>
            </div>
        </div>
        
        <!-- Loading State -->
        <div x-show="loading && containers.length === 0" class="bg-slate-800 rounded-lg border border-slate-700 p-12 text-center">
            <div class="text-6xl mb-4">‚è≥</div>
            <h3 class="text-xl font-semibold text-white mb-2">Loading Containers</h3>
            <p class="text-slate-400">Fetching container data from Docker daemon...</p>
        </div>
        
        <!-- Error State -->
        <div x-show="error && !loading" class="bg-red-900 bg-opacity-20 border border-red-600 rounded-lg p-6 mb-6">
            <div class="flex items-start">
                <div class="text-red-500 text-3xl mr-4">‚ö†</div>
                <div class="flex-1">
                    <h3 class="text-lg font-semibold text-red-400 mb-2">Error Loading Containers</h3>
                    <p class="text-red-300 mb-4" x-text="error"></p>
                    <button @click="loadContainers()" 
                            class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition">
                        Try Again
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Empty State -->
        <div x-show="!loading && !error && filteredContainers.length === 0 && containers.length === 0" 
             class="bg-slate-800 rounded-lg border border-slate-700 p-12 text-center">
            <div class="text-6xl mb-4">üì¶</div>
            <h3 class="text-2xl font-semibold text-white mb-2">No Containers Yet</h3>
            <p class="text-slate-400 mb-6">
                You haven't created any containers yet. Get started by creating your first container.
            </p>
            <button class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition opacity-50 cursor-not-allowed" 
                    disabled
                    title="Coming in Task 7">
                + Create Your First Container
            </button>
        </div>
        
        <!-- No Results from Filters -->
        <div x-show="!loading && !error && filteredContainers.length === 0 && containers.length > 0" 
             class="bg-slate-800 rounded-lg border border-slate-700 p-8 text-center">
            <div class="text-4xl mb-4">üîç</div>
            <h3 class="text-xl font-semibold text-white mb-2">No Matching Containers</h3>
            <p class="text-slate-400 mb-4">
                No containers match your current filters. Try adjusting your search criteria.
            </p>
            <button @click="clearFilters()" 
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition">
                Clear Filters
            </button>
        </div>
        
        <!-- Container List -->
        <div x-show="!loading && !error && filteredContainers.length > 0" class="space-y-4">
            <template x-for="container in filteredContainers" :key="container.id">
                <div class="bg-slate-800 rounded-lg border border-slate-700 p-6 hover:border-slate-600 transition">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                        <!-- Container Info -->
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <h3 class="text-xl font-semibold text-white" x-text="container.name"></h3>
                                
                                <!-- Status Badge -->
                                <span :class="{
                                    'bg-green-600': container.status === 'running',
                                    'bg-red-600': container.status === 'stopped' || container.status === 'exited',
                                    'bg-yellow-600': container.status === 'paused',
                                    'bg-blue-600': container.status === 'created'
                                }" class="px-2 py-1 rounded text-white text-xs font-medium uppercase" x-text="container.status"></span>
                                
                                <!-- Environment Tag -->
                                <span x-show="container.environment" 
                                      :class="{
                                          'bg-red-600': container.environment === 'PRD',
                                          'bg-yellow-600': container.environment === 'UAT',
                                          'bg-green-600': container.environment === 'DEV',
                                          'bg-blue-600': container.environment === 'SANDBOX'
                                      }"
                                      class="px-2 py-1 rounded text-white text-xs font-medium"
                                      x-text="container.environment"></span>
                            </div>
                            
                            <div class="space-y-1 text-sm">
                                <p class="text-slate-400">
                                    <span class="font-medium">Image:</span> 
                                    <span class="font-mono text-slate-300" x-text="container.image"></span>
                                </p>
                                <p class="text-slate-400">
                                    <span class="font-medium">ID:</span> 
                                    <span class="font-mono text-slate-300" x-text="container.container_id ? container.container_id.substring(0, 12) : 'N/A'"></span>
                                </p>
                                <p x-show="container.ports && container.ports.length > 0" class="text-slate-400">
                                    <span class="font-medium">Ports:</span> 
                                    <span class="font-mono text-slate-300" x-text="container.ports ? container.ports.join(', ') : 'None'"></span>
                                </p>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex flex-wrap gap-2 lg:ml-4">
                            <!-- Start Button -->
                            <button x-show="container.status !== 'running'"
                                    @click="performAction(container.id, 'start')"
                                    :disabled="actionLoading[container.id]"
                                    title="Start container (docker start)"
                                    class="px-3 py-2 bg-green-600 hover:bg-green-700 disabled:bg-green-400 disabled:cursor-not-allowed text-white rounded-md transition text-sm font-medium">
                                <span x-show="!actionLoading[container.id]">‚ñ∂ Start</span>
                                <span x-show="actionLoading[container.id]">‚è≥</span>
                            </button>
                            
                            <!-- Stop Button -->
                            <button x-show="container.status === 'running'"
                                    @click="performAction(container.id, 'stop')"
                                    :disabled="actionLoading[container.id]"
                                    title="Stop container (docker stop)"
                                    class="px-3 py-2 bg-yellow-600 hover:bg-yellow-700 disabled:bg-yellow-400 disabled:cursor-not-allowed text-white rounded-md transition text-sm font-medium">
                                <span x-show="!actionLoading[container.id]">‚è∏ Stop</span>
                                <span x-show="actionLoading[container.id]">‚è≥</span>
                            </button>
                            
                            <!-- Restart Button -->
                            <button x-show="container.status === 'running'"
                                    @click="performAction(container.id, 'restart')"
                                    :disabled="actionLoading[container.id]"
                                    title="Restart container (docker restart)"
                                    class="px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white rounded-md transition text-sm font-medium">
                                <span x-show="!actionLoading[container.id]">üîÑ Restart</span>
                                <span x-show="actionLoading[container.id]">‚è≥</span>
                            </button>
                            
                            <!-- Details Button -->
                            <button @click="showDetails(container)"
                                    class="px-3 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-md transition text-sm font-medium">
                                ‚Ñπ Details
                            </button>
                            
                            <!-- Delete Button -->
                            <button @click="showDeleteConfirmation(container.id, container.name)"
                                    :disabled="actionLoading[container.id]"
                                    title="Delete container (docker rm)"
                                    class="px-3 py-2 bg-red-600 hover:bg-red-700 disabled:bg-red-400 disabled:cursor-not-allowed text-white rounded-md transition text-sm font-medium">
                                <span x-show="!actionLoading[container.id]">üóë Delete</span>
                                <span x-show="actionLoading[container.id]">‚è≥</span>
                            </button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
        
        <!-- Auto-refresh Indicator -->
        <div x-show="!loading && containers.length > 0" class="mt-6 text-center">
            <p class="text-slate-500 text-sm">
                üîÑ Auto-refreshing every 10 seconds | Last updated: <span x-text="lastUpdated"></span>
            </p>
        </div>
    </main>
</div>

<script>
/**
 * Containers Page Alpine.js Component
 * 
 * Manages container list display, filtering, and actions (start/stop/restart/delete).
 * Implements hardware-aware container management with educational CLI equivalents.
 * 
 * Features:
 * - Real-time container status updates (10-second polling)
 * - Multi-criteria filtering (status, environment, search)
 * - Action buttons with confirmation modals
 * - Toast notifications for user feedback
 * - Hardware limit tracking
 * - Educational Docker CLI command equivalents
 * 
 * Docker CLI Equivalents:
 * - List containers: docker ps -a
 * - Start: docker start <name>
 * - Stop: docker stop <name>
 * - Restart: docker restart <name>
 * - Delete: docker rm -f <name>
 */
function containersPage() {
    return {
        // State
        containers: [],
        filteredContainers: [],
        loading: true,
        error: null,
        actionLoading: {},
        lastUpdated: 'Never',
        pollInterval: null,
        
        // Hardware Profile
        hardwareProfile: {},
        runningCount: 0,
        
        // Filters
        filters: {
            search: '',
            status: 'all',
            environment: 'all'
        },
        
        // Toast Notification
        toast: {
            show: false,
            message: '',
            type: 'info' // success, error, info, warning
        },
        
        // Delete Modal
        deleteModal: {
            show: false,
            containerId: null,
            containerName: '',
            loading: false
        },
        
        // Details Modal
        detailsModal: {
            show: false,
            container: null
        },
        
        /**
         * Initialize component
         * Loads containers and hardware profile, sets up auto-refresh
         */
        async init() {
            await this.loadHardwareProfile();
            await this.loadContainers();
            this.startPolling();
        },
        
        /**
         * Load hardware profile to display limits
         * CLI equivalent: N/A (custom DockerMate feature)
         */
        async loadHardwareProfile() {
            try {
                const response = await fetch('/api/system/hardware');
                if (response.ok) {
                    const data = await response.json();
                    this.hardwareProfile = data.data || {};
                }
            } catch (error) {
                console.error('Failed to load hardware profile:', error);
            }
        },
        
        /**
         * Load all containers from API
         * CLI equivalent: docker ps -a
         */
        async loadContainers() {
            this.loading = true;
            this.error = null;
            
            try {
                const response = await fetch('/api/containers');
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to load containers');
                }
                
                const data = await response.json();
                this.containers = data.data || [];
                this.applyFilters();
                this.updateRunningCount();
                this.lastUpdated = new Date().toLocaleTimeString();
                
            } catch (error) {
                this.error = error.message;
                this.showToast('Failed to load containers: ' + error.message, 'error');
            } finally {
                this.loading = false;
            }
        },
        
        /**
         * Update count of running containers
         */
        updateRunningCount() {
            this.runningCount = this.containers.filter(c => c.status === 'running').length;
        },
        
        /**
         * Apply filters to container list
         */
        applyFilters() {
            let filtered = [...this.containers];
            
            // Search filter
            if (this.filters.search.trim()) {
                const search = this.filters.search.toLowerCase();
                filtered = filtered.filter(c => 
                    c.name.toLowerCase().includes(search) ||
                    c.image.toLowerCase().includes(search) ||
                    (c.container_id && c.container_id.toLowerCase().includes(search))
                );
            }
            
            // Status filter
            if (this.filters.status !== 'all') {
                filtered = filtered.filter(c => c.status === this.filters.status);
            }
            
            // Environment filter
            if (this.filters.environment !== 'all') {
                if (this.filters.environment === 'none') {
                    filtered = filtered.filter(c => !c.environment);
                } else {
                    filtered = filtered.filter(c => c.environment === this.filters.environment);
                }
            }
            
            this.filteredContainers = filtered;
        },
        
        /**
         * Check if any filters are active
         */
        hasActiveFilters() {
            return this.filters.search.trim() !== '' || 
                   this.filters.status !== 'all' || 
                   this.filters.environment !== 'all';
        },
        
        /**
         * Clear all filters
         */
        clearFilters() {
            this.filters.search = '';
            this.filters.status = 'all';
            this.filters.environment = 'all';
            this.applyFilters();
        },
        
        /**
         * Perform container action (start/stop/restart)
         * CLI equivalents:
         * - Start: docker start <name>
         * - Stop: docker stop <name>
         * - Restart: docker restart <name>
         */
        async performAction(containerId, action) {
            this.actionLoading[containerId] = true;
            
            try {
                const response = await fetch(`/api/containers/${containerId}/${action}`, {
                    method: 'POST'
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `Failed to ${action} container`);
                }
                
                const data = await response.json();
                this.showToast(`Container ${action} successful`, 'success');
                
                // Reload containers to get updated status
                await this.loadContainers();
                
            } catch (error) {
                this.showToast(`Failed to ${action} container: ${error.message}`, 'error');
            } finally {
                this.actionLoading[containerId] = false;
            }
        },
        
        /**
         * Show delete confirmation modal
         */
        showDeleteConfirmation(containerId, containerName) {
            this.deleteModal.containerId = containerId;
            this.deleteModal.containerName = containerName;
            this.deleteModal.show = true;
        },
        
        /**
         * Confirm and execute container deletion
         * CLI equivalent: docker rm -f <name>
         */
        async confirmDelete() {
            this.deleteModal.loading = true;
            
            try {
                const response = await fetch(`/api/containers/${this.deleteModal.containerId}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to delete container');
                }
                
                this.showToast(`Container "${this.deleteModal.containerName}" deleted successfully`, 'success');
                this.deleteModal.show = false;
                
                // Reload containers
                await this.loadContainers();
                
            } catch (error) {
                this.showToast(`Failed to delete container: ${error.message}`, 'error');
            } finally {
                this.deleteModal.loading = false;
            }
        },
        
        /**
         * Show container details modal
         */
        showDetails(container) {
            this.detailsModal.container = container;
            this.detailsModal.show = true;
        },
        
        /**
         * Generate Docker CLI command equivalent for educational purposes
         */
        generateDockerCommand(container) {
            if (!container) return '';
            
            let cmd = `docker run -d --name ${container.name}`;
            
            // Add ports
            if (container.ports && container.ports.length > 0) {
                container.ports.forEach(port => {
                    cmd += ` \\\n  -p ${port}`;
                });
            }
            
            // Add environment variables
            if (container.env_vars && container.env_vars.length > 0) {
                container.env_vars.forEach(env => {
                    cmd += ` \\\n  -e "${env}"`;
                });
            }
            
            // Add volumes
            if (container.volumes && container.volumes.length > 0) {
                container.volumes.forEach(volume => {
                    cmd += ` \\\n  -v ${volume}`;
                });
            }
            
            // Add labels
            if (container.labels) {
                Object.entries(container.labels).forEach(([key, value]) => {
                    cmd += ` \\\n  --label ${key}=${value}`;
                });
            }
            
            // Add image
            cmd += ` \\\n  ${container.image}`;
            
            return cmd;
        },
        
        /**
         * Format date for display
         */
        formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleString();
        },
        
        /**
         * Show toast notification
         */
        showToast(message, type = 'info') {
            this.toast.message = message;
            this.toast.type = type;
            this.toast.show = true;
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                this.toast.show = false;
            }, 5000);
        },
        
        /**
         * Start auto-refresh polling (every 10 seconds)
         * Educational note: Keeps UI in sync with Docker daemon state
         */
        startPolling() {
            this.pollInterval = setInterval(() => {
                if (!this.loading && !this.deleteModal.show && !this.detailsModal.show) {
                    this.loadContainers();
                }
            }, 10000); // 10 seconds
        },
        
        /**
         * Cleanup on component destroy
         */
        destroy() {
            if (this.pollInterval) {
                clearInterval(this.pollInterval);
            }
        }
    }
}
</script>
{% endblock %}