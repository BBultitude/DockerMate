version: '3.8'

services:
  dockermate:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: dockermate-dev
    ports:
      - "5000:5000"
    volumes:
      # Mount Docker socket for container management
      - /var/run/docker.sock:/var/run/docker.sock:ro
      
      # Mount source code for live development
      - ./backend:/app/backend
      - ./frontend:/app/frontend
      - ./app.py:/app/app.py
      - ./manage.py:/app/manage.py
      - ./migrations:/app/migrations
      - ./alembic.ini:/app/alembic.ini
      
      # Persist database
      - ./data:/app/data
      
      # Persist SSL certificates
      - ./certs:/app/certs
    environment:
      - FLASK_ENV=development
      - FLASK_DEBUG=1
      - DATABASE_PATH=/app/data/dockermate.db
      - DOCKERMATE_SSL_MODE=self-signed  # HTTPS for production-style testing
      - PYTHONUNBUFFERED=1  # See logs immediately
    restart: unless-stopped
    networks:
      - dockermate-net

networks:
  dockermate-net:
    driver: bridge